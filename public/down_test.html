<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>测试fetch下载文件流</title>
  </head>
  <body>
    <button type="button" name="button" class="btn">下载文件</button>
    <script type="text/javascript">
      window.onload = function() {
        var btn = document.querySelector('.btn')
        btn.onclick = function() {
          fetch('http://127.0.0.1:6001/api/v1/download', {
            method: 'POST',
            body: JSON.stringify({ time: new Date().getTime() }),
            headers: new Headers({
              'Content-Type': 'application/json',
              'authorization': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjE1NjAwMTIxMTc3IiwiYXBwbGljYXRpb24iOmZhbHNlLCJpYXQiOjE2MTAwOTcxMDcsImV4cCI6MTYxMDcwMTkwN30.iA-_X51qRNGIwAmKr0D0OHIr2g0dhmHPtgB-AM_hGQo'
            })
          }).then(res => {
            if (res.ok) {
              return res.blob();
            }
          }).then(blob => {
            const reader = new FileReader();
            reader.readAsDataURL(blob);
            reader.onload = e => {
              const a = document.createElement('a');
              a.download = 'fileName.xlsx';
              a.href = e.target.result;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
            };
          })
        }
      }
    </script>
  </body>
</html>
